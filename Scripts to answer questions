-- WITHOUT TESTING Question 1
-- "What are the peak hours for viewership on YouTube?”
SELECT
    TO_CHAR(watch_date, 'HH24') AS watching_times,
    COUNT(*) AS viewership_count
FROM
    watch_history
GROUP BY
    TO_CHAR(watch_date, 'HH24')
ORDER BY
    viewership_count DESC;


--WITHOUT TESTING Question 2
-- “What are the most watched videos on YouTube and what time are they watched?” 

SELECT *
FROM (
    SELECT
        v.title AS most_watched_video,
        COUNT(*) AS watch_count,
        MAX(h.watch_date) AS most_recent_watch_time
    FROM
        watch_history h
    JOIN
        videos v ON h.video_id = v.video_id
    GROUP BY
        v.title
    ORDER BY
        watch_count DESC
)
WHERE ROWNUM = 1;

-- Question 6
--  “How does the genre of videos change during different times of the year?”

SELECT
    EXTRACT(MONTH FROM release_date) AS month,
    genre,
    COUNT(*) AS genre_count
FROM
    videos
GROUP BY
    EXTRACT(MONTH FROM release_date),
    genre
ORDER BY
    EXTRACT(MONTH FROM release_date),
    genre;

-- WITHOUT TESTING Question 7
-- “What are the most common trending genres watched?” 
SELECT
    genre,
    SUM(views) AS total_views
FROM
    videos
GROUP BY
    genre
ORDER BY
    total_views DESC;

--WITHOUT TESTING Question 8
-- “What type of video duration content are users mostly consuming?” 
SELECT
    u.user_id,
    u.username,
    AVG(v.duration_seconds) AS average_duration
FROM
    users u
JOIN
    watch_history wh ON u.user_id = wh.user_id
JOIN
    videos v ON wh.video_id = v.video_id
GROUP BY
    u.user_id, u.username
ORDER BY
    average_duration DESC;

